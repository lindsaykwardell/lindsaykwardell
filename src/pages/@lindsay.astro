---
import MicroblogPost from "../layouts/MicroblogPost.astro";
import Parser from 'rss-parser';
import MicroPost from "../components/MicroPost.astro";

const feedUrl = "https://mastodon.social/@lindsaykwardell.rss"
const parser = new Parser()

const feed = await parser.parseURL(feedUrl);

const content = {
  title: feed.title,
  snippet: "Public posts from @lindsay@lindsaykwardell.com",
  slug: "/@lindsay"
}
---
<MicroblogPost content={content}>
{feed.items.map(item => (
  <MicroPost 
    avatar={feed.image.url}
    displayName={feed.title}
    content={item.content}
    createdAt={item.pubDate}
    url={item.link}
  />
))}
</MicroblogPost>