---
import MicroblogPost from "../layouts/MicroblogPost.astro";
import MicroPost from "../components/MicroPost.astro";

const user = await fetch("https://mastodon.social/api/v1/accounts/109248168582410861").then((res) => res.json());
const data = await fetch("https://mastodon.social/api/v1/accounts/109248168582410861/statuses?exclude_reblogs=true").then(res => res.json())

const content = {
  title: user.display_name,
  snippet: "Public posts from @lindsay@lindsaykwardell.com",
  slug: "/@lindsay"
}
---
<MicroblogPost content={content}>
  {data.map(item => (
    <MicroPost 
      avatar={item.account.avatar}
      url={item.url}
      username={item.account.username}
      userPage={item.account.url}
      createdAt={item.created_at}
      displayName={item.account.display_name}
      content={item.content}
      attachments={item.media_attachments}
      card={item.card}
      postStats={{
        repliesCount: item.replies_count,
        reblogsCount: item.reblogs_count,
        favouritesCount: item.favourites_count,
      }}
    />
  ))}
</MicroblogPost>